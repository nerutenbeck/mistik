{
    "contents" : "#####################################\n###\n### Mistik models fit with lmer()\n###\n###\n#####################################\n\n\nlibrary(arm)\nlibrary(lsmeans)\nlibrary(car)\nlibrary(plyr)\nlibrary(reshape2)\nlibrary(ggplot2)\nlibrary(xtable)\n\nsource('mistik_load.R') # Bring in cleaned mistik objects\n\n############################\n### Mixed-effects models ###\n############################\n\n### Leaf Area ###\n\nla.mer<-lmer(log(sla)~species*gappos+(1|vegtrt),data=LA,REML=T)\n\nrplot(la.mer)\nqqnorm(resid(la.mer));qqline(resid(la.mer)) # Normality of error looks OK\nplot(log(LA$sla)~fitted(la.mer));abline(0,1)\n\nla.aov<-Anova(la.mer,type=2,test.statistic='F')\nla.aov\n\nla.lsm<-lsmeans(la.mer,specs='pairwise~species*gappos')\n\nla.plot<-ggplot(ldply(la.lsm[1])[-1],\n                aes(x=gappos,y=exp(lsmean),\n                    ymin=ifelse(exp(lsmean-SE)>0,exp(lsmean-SE),0),\n                    ymax=exp(lsmean+SE),\n                    fill=species))+\n  geom_bar(stat='identity',position='dodge')+\n  geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n  scale_fill_grey()+\n  xlab(\"Gap Position\")+\n  ylab(expression(\"\"*cm^2*\"/g\"))+\n  theme_bw()+\n  theme(axis.line=element_line(color='black'),\n       panel.grid.major=element_blank(),\n       panel.grid.minor=element_blank(),\n       panel.border=element_blank(),\n       panel.background=element_blank())\n\n\n\n### Photosynthesis ###\n\nphoto.mer<-lmer(sqrt(photo)~light*species*gappos*vegtrt+(1|block/transect/gappos/treenum),\n            data=mistik,REML=T)\n\nrplot(photo.mer)\nqqnorm(resid(photo.mer));qqline(resid(photo.mer))\nqplot(resid(photo.mer),binwidth=0.1)\nplot(sqrt(mistik$photo)~fitted(photo.mer));abline(0,1)\n\nphoto.aov<-Anova(photo.mer,type=2,test.statistic='F')\nphoto.aov\n\nphoto.lsm<-lsmeans(photo.mer,specs='pairwise~light*species*gappos|light:vegtrt:species')\n\nphoto.lsm\nphoto.plot<-ggplot(ldply(photo.lsm[1])[-1],aes(x=gappos,y=I(lsmean^2),\n                                 ymin=ifelse(I((lsmean-SE)^2)>0,I((lsmean-SE)^2),0),\n                                 ymax=I((lsmean+SE)^2),\n                                 fill=species))+\n  geom_bar(stat='identity',position='dodge')+\n  geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n  facet_grid(.+light~vegtrt)+scale_fill_grey()+\n  xlab(\"Gap Position\")+ylim(0,25)+\n  ylab(expression(\" A (\"*mu*\"mol \"*CO[2]*\" \"*m^-2*\" \"*s^-1*\")\"))+\n  theme_bw()+\n  theme(axis.line=element_line(color='black'),\n        panel.grid.major=element_blank(),\n        panel.grid.minor=element_blank(),\n        panel.border=element_rect(color='black'),\n        panel.background=element_blank())\nphoto.plot\n\nphoto.plot2<-ggplot(ldply(photo.lsm[1])[-1],aes(x=gappos,y=I(lsmean^2),\n                                               ymin=ifelse(I((lower.CL)^2)>0,I((lower.CL)^2),0),\n                                               ymax=I((upper.CL)^2),\n                                               fill=species))+\n  geom_bar(stat='identity',position='dodge')+\n  geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n  facet_grid(.+light~vegtrt)+scale_fill_grey()+\n  xlab(\"Gap Position\")+ylim(0,40)+\n  ylab(expression(\" A (\"*mu*\"mol \"*CO[2]*\" \"*m^-2*\" \"*s^-1*\")\"))+\n  theme_bw()+\n  theme(axis.line=element_line(color='black'),\n        panel.grid.major=element_blank(),\n        panel.grid.minor=element_blank(),\n        panel.border=element_rect(color='black'),\n        panel.background=element_blank())\nphoto.plot2\n\n\n### Conductance ###\n\ncond.mer<-lmer(sqrt(cond)~light*species*gappos*vegtrt+(1|block/transect/gappos/treenum),\n               data=mistik,REML=T)\nrplot(cond.mer) # may be a few outliers, but not sure whether to toss them or not...\n\nqqnorm(resid(cond.mer));qqline(resid(cond.mer))\nqplot(resid(cond.mer),binwidth=0.01)\n\ncond.aov<-Anova(cond.mer,type=2,test.statistic='F')\ncond.aov\n\ncond.lsm<-lsmeans(cond.mer,specs='pairwise~light*species*gappos|light:vegtrt:species')\ncond.lsm\n\ncond.plot<-ggplot(ldply(cond.lsm[1])[-1],aes(x=gappos,y=I(lsmean^2),\n                                 ymin=ifelse(I((lsmean-SE)^2)>0,I((lsmean-SE)^2),0),\n                                 ymax=I((lsmean+SE)^2),\n                                 fill=species))+\n  geom_bar(stat='identity',position='dodge')+\n  geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n  facet_grid(.+light~vegtrt)+scale_fill_grey()+\n  xlab(\"Gap Position\")+ylim(0,0.5)+\n  ylab(expression(\"\"*g[sw]*\" (\"*mu*\"mol \"*CO[2]*\" \"*m^-2*\" \"*s^-1*\")\"))+\n  theme_bw()+\n  theme(axis.line=element_line(color='black'),\n        panel.grid.major=element_blank(),\n        panel.grid.minor=element_blank(),\n        panel.border=element_rect(color='black'),\n        panel.background=element_blank())\ncond.plot\n\n\n### Transpiration ###\n\ntrmmol.mer<-lmer(sqrt(trmmol)~light*species*gappos*vegtrt+(1|block/transect/gappos/treenum),\n                 data=mistik,REML=T)\n\nrplot(trmmol.mer)\nqqnorm(resid(trmmol.mer));qqline(resid(trmmol.mer))\nqplot(resid(trmmol.mer),binwidth=0.05)\nplot(sqrt(mistik$trmmol)~fitted(trmmol.mer));abline(0,1)\n\ntrmmol.aov<-Anova(trmmol.mer,type=2,test.statistic='F')\ntrmmol.aov\n\ntrmmol.mer2<-update(trmmol.mer,.~.-vegtrt-light:vegtrt-species:vegtrt-\n                      gappos:vegtrt-light:species:vegtrt-light:gappos:vegtrt-\n                      species:gappos:vegtrt-light:species:gappos:vegtrt)\n\ntrmmol.aov2<-Anova(trmmol.mer2,type=2,test.statistic='F')\ntrmmol.aov2\n\ntrmmol.lsm<-lsmeans(trmmol.mer2,specs='pairwise~light*species*gappos')\ntrmmol.lsm\n\ntrmmol.plot<-ggplot(ldply(trmmol.lsm[1])[-1],aes(x=gappos,y=I(lsmean^2),\n                                 ymin=ifelse(I((lsmean-SE)^2)>0,I((lsmean-SE)^2),0),\n                                 ymax=I((lsmean+SE)^2),\n                                 fill=species))+\n  geom_bar(stat='identity',position='dodge')+\n  geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n  facet_grid(.~light)+scale_fill_grey()+\n  xlab(\"Gap Position\")+ylim(0,5)+\n  ylab(expression(\"\"*mu*\"mol \"*H[2]*\"O \"*m^2*\" \"*s^-1*\"\"))+\n  theme_bw()+\n  theme(axis.line=element_line(color='black'),\n        panel.grid.major=element_blank(),\n        panel.grid.minor=element_blank(),\n        panel.border=element_rect(color='black'),\n        panel.background=element_blank())\ntrmmol.plot\n\n# \n# # Ditch WUE? looks a little too crazy...\n# ### WUE ###\n# \n# wue.mer<-lmer(log(wue)~light*species*gappos*vegtrt+(1|block/transect/gappos/treenum),\n#               data=mistik,REML=T)\n# rplot(wue.mer) # outliers over 2.5?\n# qqnorm(resid(wue.mer));qqline(resid(wue.mer))\n# qplot(resid(wue.mer),binwidth=0.1)\n# plot(log(mistik$wue)~fitted(wue.mer));abline(0,1)\n# \n# wue.aov<-Anova(wue.mer,type=2,test.statistic='F')\n# wue.aov\n# print(xtable(wue.aov,include.rownames=F),file='wue.tex',floating=F)\n# \n# wue.lsm<-ldply(lsmeans(wue.mer,\n#                          specs='pairwise~light*species*gappos|light:vegtrt:species')[1])[-1]\n# wue.lsm\n# wue.plot<-ggplot(wue.lsm,aes(x=gappos,y=exp(lsmean),\n#                                  ymin=ifelse(exp(lsmean-SE)>0,exp(lsmean-SE),0),\n#                                  ymax=exp(lsmean+SE),\n#                                  fill=species))+\n#   geom_bar(stat='identity',position='dodge')+\n#   geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n#   facet_grid(.+light~vegtrt)+scale_fill_grey()+\n#   xlab(\"Gap Position\")+ylim(0,40)+\n#   ylab(expression(\"\"*mu*\"mol \"*CO[2]*\"/\"*mu*\"mol \"*H[2]*\"O\"))+\n#   theme_bw()+\n#   theme(axis.line=element_line(color='black'),\n#         panel.grid.major=element_blank(),\n#         panel.grid.minor=element_blank(),\n#         panel.border=element_rect(color='black'),\n#         panel.background=element_blank())\n# wue.plot\n\n\n### PPI ###\n\ntemp1<-ddply(m1200[,-c(3,5,37)],.(species,block,transect,vegtrt,gappos,treenum),\n             summarize,photo1200=mean(photo))\ntemp2<-ddply(m50[-c(3,5,37)],.(species,block,transect,vegtrt,gappos,treenum),\n             summarize,photo50=mean(photo))\nplastic<-merge(temp1,temp2,by=c('block','transect','vegtrt','gappos','species','treenum'))\nhead(plastic)\nplastic$plast<-(plastic$photo1200-plastic$photo50)/plastic$photo1200\n\nplastic<-plastic[plastic$plast>0,]\nplast.gg<-ggplot(plastic,aes(x=gappos,y=plast))+\n  ggtitle(\"Photosynthetic Plasticity\")+\n  xlab(\"Gap Position\")+\n  ylab(\"PPI\")\n\nplast.gg+geom_point()+\n  facet_grid(.~species*vegtrt)\n\nplast.gg+geom_boxplot()+\n  facet_grid(.~vegtrt)+\n  aes(fill=species)\n\nqplot(plast,data=plastic,binwidth=0.05)+facet_wrap(~species)\nqplot(logit(plast),data=plastic,binwidth=0.3)+facet_wrap(~species)\n\nplast.mer<-lmer(logit(plast)~species*gappos*vegtrt+(1|block/transect/gappos),\n           data=plastic,REML=T)\nrplot(plast.mer)\nqqnorm(resid(plast.mer));qqline(resid(plast.mer)) # Normal-ish\n\nplot(logit(plastic$plast)~fitted(plast.mer));abline(0,1) # Fit looks pretty good.\n\nplast.aov<-Anova(plast.mer,type=2,test.statistic='F')\nplast.aov # Nothing significant, do no further testing\n\n# Random effects table\nran<-as.data.frame(rbind(sigma.hat(photo.mer)$sigma,\n           sigma.hat(cond.mer)$sigma,\n           sigma.hat(trmmol.mer)$sigma))[,c(5,4,3,2,1)]\nran\nnames(ran)<-c('Block','Transect','Plot','Tree','Residual')\n\nrow.names(ran)<-c('Photosynthesis','Conductance','Transpiration')\nran\n\nfor(i in 1:length(ran)){\n  ran[i]<-as.numeric(ran[[i]]^2)\n}\nran\n\n# #######################\n# ### Light submodels ###\n# #######################\n# \n# ### Photosynthesis 1200 ###\n# \n# mer1<-lmer(photo~species*gappos*vegtrt+(1|block/transect/gappos/treenum),\n#                      data=m1200,REML=T)\n# \n# rplot(mer1)\n# qqnorm(resid(mer1));qqline(resid(mer1))\n# qplot(resid(mer1,binwidth=0.1))\n# abs(resid(mer1))>5\n# m1200<-m1200[-c(357),] # Remove outlier\n# \n# mer2<-update(mer1,data=m1200)\n# rplot(mer2)\n# qqnorm(resid(mer2));qqline(resid(mer1))\n# qplot(resid(mer2),binwidth=0.1)\n# \n# photo.1200.mer<-mer2\n# \n# photo.1200.aov<-Anova(photo.1200.mer,type=2,test.statistic='F')\n# photo.1200.aov\n# \n# plot(m1200$photo~fitted(photo.1200.mer)); abline(0,1)\n# \n# summary(photo.1200.mer)\n# \n# photo.1200.lsm<-ldply(lsmeans(photo.1200.mer,specs='pairwise~species*gappos|vegtrt:species')[1])[-1]\n# \n# photo.1200.plot<-ggplot(photo.1200.lsm,aes(x=gappos,y=lsmean,\n#                                            ymin=ifelse(lsmean-SE>0,lsmean-SE,0),\n#                                            ymax=lsmean+SE,\n#                                            fill=species))+\n#   geom_bar(stat='identity',position='dodge')+\n#   geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n#   facet_grid(.~vegtrt)+scale_fill_grey()+\n#   xlab(\"Gap Position\")+ylim(0,25)+\n#   ylab(expression(\"\"*mu*\"mol \"*CO[2]*\"\"))+\n#   theme_bw()+\n#   theme(axis.line=element_line(color='black'),\n#         panel.grid.major=element_blank(),\n#         panel.grid.minor=element_blank(),\n#         panel.border=element_rect(color='black'),\n#         panel.background=element_blank())\n# \n# \n# photo.1200.plot\n# \n# \n# ### Photosynthesis 50 ###\n# \n# photo.50.mer<-lmer(photo~species*gappos*vegtrt+(1|block/transect/gappos/treenum),\n#            data=m50) \n# rplot(photo.50.mer)# log-transforming this model is equally bad\n# qplot(resid(photo.50.mer),binwidth=0.1)\n# qqnorm(resid(photo.50.mer));qqline(resid(photo.50.mer)) # pretty good\n# \n# photo.50.aov<-Anova(photo.50.mer,type=2,test.statistic='F')\n# photo.50.aov\n# \n# photo.50.lsm<-ldply(lsmeans(photo.50.mer,specs='pairwise~gappos*species|vegtrt:species')[1])[-1]\n# \n# photo.50.plot<-ggplot(photo.50.lsm,aes(x=gappos,y=lsmean,\n#                                        ymin=ifelse(lsmean-SE>0,lsmean-SE,0),\n#                                        ymax=lsmean+SE,\n#                                        fill=species))+\n#   geom_bar(stat='identity',position='dodge')+\n#   geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n#   facet_grid(.~vegtrt)+scale_fill_grey()+\n#   xlab(\"Gap Position\")+ylim(0,5)+\n#   ylab(expression(\"\"*mu*\"mol \"*CO[2]*\"\"))+\n#   theme_bw()+\n#   theme(axis.line=element_line(color='black'),\n#         panel.grid.major=element_blank(),\n#         panel.grid.minor=element_blank(),\n#         panel.border=element_rect(color='black'),\n#         panel.background=element_blank())\n# \n# photo.50.plot\n# \n# \n# ### Conductance 1200 ###\n# \n# cond.1200.mer<-lmer(cond~species*gappos*vegtrt+(1|block/transect/gappos/treenum),\n#            data=m1200,REML=T)\n# \n# rplot(cond.1200.mer)\n# qqnorm(resid(cond.1200.mer));qqline(resid(cond.1200.mer))\n# qplot(resid(cond.1200.mer),binwidth=0.01)\n# abs(resid(cond.1200.mer))>0.15\n# m1200<-m1200[-c(55,57,66,67,126),] # Remove outliers\n# \n# mer2<-update(cond.1200.mer,data=m1200)\n# rplot(mer2)\n# qqnorm(resid(mer2));qqline(resid(mer2))\n# qplot(resid(mer2),binwidth=0.01)\n# \n# cond.1200.mer<-mer2\n# \n# cond.1200.aov<-Anova(cond.1200.mer,type=2,test.statistic='F')\n# cond.1200.aov\n# \n# plot(m1200$cond~fitted(cond.1200.mer)); abline(0,1)\n# \n# summary(cond.1200.mer)\n# \n# cond.1200.lsm<-ldply(lsmeans(cond.1200.mer,specs='pairwise~species*gappos|vegtrt:species')[1])[-1]\n# \n# cond.1200.plot<-ggplot(cond.1200.lsm,aes(x=gappos,y=lsmean,\n#                                          ymin=ifelse(lsmean-SE>0,lsmean-SE,0),\n#                                          ymax=lsmean+SE,\n#                                          fill=species))+\n#   geom_bar(stat='identity',position='dodge')+\n#   geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n#   facet_grid(.~vegtrt)+scale_fill_grey()+\n#   xlab(\"Gap Position\")+ylim(0,1)+\n#   ylab(expression(\"\"*mu*\"mol \"*H[2]*\"O\"))+\n#   theme_bw()+\n#   theme(axis.line=element_line(color='black'),\n#         panel.grid.major=element_blank(),\n#         panel.grid.minor=element_blank(),\n#         panel.border=element_rect(color='black'),\n#         panel.background=element_blank())\n# \n# \n# cond.1200.plot\n# \n# \n# ### Conductance 50 ###\n# \n# cond.50.mer<-lmer(cond~species*gappos*vegtrt+(1|block/transect/gappos/treenum),\n#                    data=m50) \n# rplot(cond.50.mer)# log-transforming this model is equally bad\n# qplot(resid(cond.50.mer),binwidth=0.01)\n# abs(resid(cond.50.mer))>0.15\n# m50<-m50[-c(332,67),]\n# \n# qqnorm(resid(cond.50.mer));qqline(resid(cond.50.mer)) # pretty good\n# \n# cond.50.aov<-Anova(cond.50.mer,type=2,test.statistic='F')\n# cond.50.aov\n# \n# cond.50.lsm<-ldply(lsmeans(cond.50.mer,specs='pairwise~gappos*species|vegtrt:species')[1])[-1]\n# \n# cond.50.plot<-ggplot(cond.50.lsm,aes(x=gappos,y=lsmean,\n#                                      ymin=ifelse(lsmean-SE>0,lsmean-SE,0),\n#                                      ymax=lsmean+SE,\n#                                      fill=species))+\n#   geom_bar(stat='identity',position='dodge')+\n#   geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n#   facet_grid(.~vegtrt)+scale_fill_grey()+\n#   xlab(\"Gap Position\")+ylim(0,1)+\n#   ylab(expression(\"\"*mu*\"mol \"*CO[2]*\"\"))+\n#   theme_bw()+\n#   theme(axis.line=element_line(color='black'),\n#         panel.grid.major=element_blank(),\n#         panel.grid.minor=element_blank(),\n#         panel.border=element_rect(color='black'),\n#         panel.background=element_blank())\n# \n# cond.50.plot\n# \n# \n# \n# ### Transpiration 1200 ###\n# \n# tr.1200.mer<-lmer(trmmol~species*gappos*vegtrt+(1|block/transect/gappos/treenum),\n#                   data=m1200)\n# \n# rplot(tr.1200.mer) # transforming causes similar problems\n# qqnorm(resid(tr.1200.mer));qqline(resid(tr.1200.mer))\n# qplot(resid(tr.1200.mer))\n# plot(m1200$trmmol~fitted(tr.1200.mer));abline(0,1)\n# \n# trmmol.1200.aov<-Anova(tr.1200.mer,type=2,test.statistic='F')\n# trmmol.1200.aov\n# \n# tr.1200.lsm<-lsmeans(update(tr.1200.mer,.~.-species:gappos:vegtrt-gappos:vegtrt-species:vegtrt-vegtrt),\n#                      specs='pairwise~species:gappos')\n# \n# tr.1200.plot<-ggplot(ldply(tr.1200.lsm[1])[-1],aes(x=gappos,y=lsmean,\n#                                        ymin=ifelse(lsmean-SE>0,lsmean-SE,0),\n#                                        ymax=lsmean+SE,\n#                                        fill=species))+\n#   geom_bar(stat='identity',position='dodge')+\n#   geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n#   scale_fill_grey()+xlab('Gap Position')+ylim(0,4)+\n#   ylab(expression(\"\"*mu*\"mol \"*H[2]*\"O \"*m^2*\" \"*s^-1*\"\"))+\n#   theme_bw()+\n#   theme(axis.line=element_line(color='black'),\n#         panel.grid.major=element_blank(),\n#         panel.grid.minor=element_blank(),\n#         panel.border=element_rect(color='black'),\n#         panel.background=element_blank())\n# \n# tr.1200.plot\n# \n# \n# ### Transpiration 50 ###\n# \n# tr.50.mer<-lmer(trmmol~species*gappos*vegtrt+(1|block/transect/gappos/treenum),\n#                   data=m50)\n# \n# \n# rplot(tr.50.mer)\n# qqnorm(resid(tr.50.mer));qqline(resid(tr.50.mer))\n# qplot(resid(tr.50.mer))\n# plot(m50$trmmol~fitted(tr.50.mer));abline(0,1)\n# \n# trmmol.50.aov<-Anova(tr.50.mer,type=2,test.statistic='F')\n# trmmol.50.aov\n# \n# \n# tr.50.lsm<-lsmeans(update(tr.50.mer,.~.-species:gappos:vegtrt-gappos:vegtrt-species:vegtrt-vegtrt),\n#                    specs='pairwise~species:gappos')\n# \n# tr.50.plot<-ggplot(ldply(tr.50.lsm[1])[-1],\n#                    aes(x=gappos,y=lsmean,\n#                        ymin=ifelse(lsmean-SE>0,lsmean-SE,0),\n#                        ymax=lsmean+SE,\n#                        fill=species))+\n#   geom_bar(stat='identity',position='dodge')+\n#   geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n#   scale_fill_grey()+\n#   xlab(\"Gap Position\")+ylim(0,4)+\n#   ylab(expression(\"\"*mu*\"mol \"*H[2]*\"O \"*m^2*\" \"*s^-1*\"\"))+\n#   theme_bw()+\n#   theme(axis.line=element_line(color='black'),\n#         panel.grid.major=element_blank(),\n#         panel.grid.minor=element_blank(),\n#         panel.border=element_rect(color='black'),\n#         panel.background=element_blank())\n# \n# tr.50.plot\n# \n# \n# ### WUE 1200 ###\n# \n# wue.1200.mer<-lmer(log(wue)~species*gappos*vegtrt+(1|block/transect/gappos/treenum),\n#                   data=m1200)\n# \n# rplot(wue.1200.mer)\n# qqnorm(resid(wue.1200.mer));qqline(resid(wue.1200.mer))\n# qplot(resid(wue.1200.mer),binwidth=0.1)\n# plot(log(m1200$wue)~fitted(wue.1200.mer));abline(0,1)\n# \n# wue.1200.aov<-Anova(wue.1200.mer,type=2,test.statistic='F')\n# wue.1200.aov\n# \n# wue.1200.aov2<-Anova(update(wue.1200.mer,.~.-species:gappos:vegtrt-gappos:vegtrt-species:vegtrt-vegtrt),\n#                             type=2,test.statistic='F')\n# wue.1200.aov2\n# \n# wue.1200.lsm<-lsmeans(update(wue.1200.mer,.~.-species:gappos:vegtrt-gappos:vegtrt-species:vegtrt-vegtrt),\n#                              specs='pairwise~species:gappos')\n# \n# wue.1200.plot<-ggplot(ldply(wue.1200.lsm[1])[-1],\n#                       aes(x=gappos,y=exp(lsmean),\n#                           ymin=ifelse(exp(lsmean-SE)>0,exp(lsmean-SE),0),\n#                           ymax=exp(lsmean+SE),\n#                           fill=species))+\n#   geom_bar(stat='identity',position='dodge')+\n#   geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n#   scale_fill_grey()+xlab('Gap Position')+\n#   ylab(expression(\"\"*mu*\"mol \"*CO[2]*\"/\"*mu*\"mol \"*H[2]*\"O\"))+\n#   theme_bw()+\n#   theme(axis.line=element_line(color='black'),\n#         panel.grid.major=element_blank(),\n#         panel.grid.minor=element_blank(),\n#         panel.border=element_rect(color='black'),\n#         panel.background=element_blank())\n# \n# \n# wue.1200.plot\n# \n# ### WUE 50 ###\n# \n# wue.50.mer<-lmer(log(wue)~species*gappos*vegtrt+(1|block/transect/gappos/treenum),\n#                  data=m50)\n# \n# rplot(wue.50.mer)\n# qqnorm(resid(wue.50.mer));qqline(resid(wue.50.mer))\n# plot(log(m50$wue)~fitted(wue.50.mer));abline(0,1)\n# qplot(resid(wue.50.mer,binwidth=0.1))\n# summary(wue.50.mer)\n# \n# wue.50.aov<-Anova(wue.50.mer,type=2,test.statistic='F')\n# wue.50.aov\n# \n# wue.50.aov2<-Anova(update(wue.50.mer,.~.-species:gappos:vegtrt-gappos:vegtrt-species:vegtrt-vegtrt),\n#                    type=2,tes.statistic='F')\n# wue.50.aov2\n# \n# # Plot Multiple comparisons\n# # wue.50.lsm<-lsmeans(wue.50.mer,specs='pairwise~species*gappos*vegtrt|vegtrt')\n# wue.50.lsm<-lsmeans(update(wue.50.mer,.~.-species:gappos:vegtrt-gappos:vegtrt-species:vegtrt-vegtrt),\n#                       specs='pairwise~species:gappos')\n# \n# wue.50.plot<-ggplot(ldply(wue.50.lsm[1])[-1],\n#                     aes(x=gappos,y=exp(lsmean),\n#                         ymin=ifelse(exp(lsmean-SE)>0,exp(lsmean-SE),0),\n#                         ymax=exp(lsmean+SE),\n#                         fill=species))+\n#   geom_bar(stat='identity',position='dodge')+\n#   geom_errorbar(width=0.4,position=position_dodge(width=0.9))+\n#   scale_fill_grey()+xlab('Gap Position')+ylim(0,5)+\n#   ylab(expression(\"\"*mu*\"mol \"*CO[2]*\"/\"*mu*\"mol \"*H[2]*\"O\"))+\n# #   facet_wrap(~vegtrt)+\n#   theme_bw()+\n#   theme(axis.line=element_line(color='black'),\n#         panel.grid.major=element_blank(),\n#         panel.grid.minor=element_blank(),\n#         panel.border=element_rect(color='black'),\n#         panel.background=element_blank())\n# wue.50.plot\n# \n\n",
    "created" : 1372039560255.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3531947979",
    "id" : "3F0F8F79",
    "lastKnownWriteTime" : 1373300164,
    "path" : "~/R/Mistik/Mistik_lmer.R",
    "properties" : {
    },
    "source_on_save" : false,
    "type" : "r_source"
}